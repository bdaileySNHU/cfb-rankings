# Story 25.1: Investigate CFBD API Response Format

**EPIC:** EPIC-025 - Fix Returning Production Import
**Status:** ✅ Complete
**Date:** 2025-12-02

---

## Investigation Results

### API Endpoint
```
GET https://api.collegefootballdata.com/player/returning?year=2024
```

### Actual Response Structure
```json
{
  "season": 2024,
  "team": "Ohio State",
  "conference": "Big Ten",
  "totalPPA": 120.7,
  "totalPassingPPA": 4.9,
  "totalReceivingPPA": 79.2,
  "totalRushingPPA": 36.6,
  "percentPPA": 0.224,
  "percentPassingPPA": 0.024,
  "percentReceivingPPA": 0.288,
  "percentRushingPPA": 0.626,
  "usage": 0.318,
  "passingUsage": 0.138,
  "receivingUsage": 0.382,
  "rushingUsage": 0.45
}
```

### Root Cause

**Our code expects:**
- Field name: `returningProduction`
- Value format: Percentage (0-100) or nested dict

**API actually provides:**
- Field name: `percentPPA` (no `returningProduction` field)
- Value format: Decimal (0.0-1.0)

**Code Location:** `import_real_data.py:146`
```python
if 'team' in r and 'returningProduction' in r:  # ❌ This field doesn't exist!
```

---

## Field Definitions

| Field | Description | Example (Ohio State) | Use Case |
|-------|-------------|---------------------|----------|
| `percentPPA` | Overall returning production % | 0.224 (22.4%) | **Best for team strength** |
| `percentPassingPPA` | Passing production % | 0.024 (2.4%) | QB/passing analysis |
| `percentReceivingPPA` | Receiving production % | 0.288 (28.8%) | Receiver analysis |
| `percentRushingPPA` | Rushing production % | 0.626 (62.6%) | RB/rushing analysis |
| `usage` | Overall usage % | 0.318 (31.8%) | Alternative metric |

**Recommendation:** Use `percentPPA` as the primary metric for team returning production.

---

## Sample Data

### High Returning Production
**App State:** `percentPPA: 0.879` (87.9% returning)
- Strong veteran team

### Medium Returning Production
**Arizona State:** `percentPPA: 0.615` (61.5% returning)
- Balanced experience

### Low Returning Production
**Ohio State:** `percentPPA: 0.224` (22.4% returning)
- Major roster turnover (likely due to NFL departures)

---

## Required Changes

1. **Field Name:** Change from `returningProduction` to `percentPPA`
2. **Value Format:** Values are already decimals, no `/100` needed
3. **Fallback Logic:** Remove complex dict handling, use simple float
4. **Validation:** Ensure 0.0 <= value <= 1.0

---

## Code Fix Preview

**Current (Broken):**
```python
for r in returning_data:
    if 'team' in r and 'returningProduction' in r:  # Wrong field name
        prod = r['returningProduction']
        # Complex dict handling...
        returning_map[team] = prod / 100  # Wrong, already decimal
```

**Fixed:**
```python
for r in returning_data:
    if 'team' in r and 'percentPPA' in r:  # Correct field name
        team = r['team']
        prod = r['percentPPA']  # Already a decimal 0.0-1.0
        returning_map[team] = prod  # No /100 needed
```

---

## Data Quality Observations

- ✅ **Coverage:** All FBS teams have data
- ✅ **Format:** Consistent structure across all teams
- ✅ **Values:** Reasonable ranges (0.024 to 0.879)
- ✅ **Team Names:** Match our database team names
- ❌ **Field Name:** Doesn't match our expectations

---

## Next Steps

Proceed to Story 25.2: Fix Import Logic

---

**Investigation Complete:** 2025-12-02
**Investigator:** Development Team
