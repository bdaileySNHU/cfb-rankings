# Story 28.4: Standardize Import Statements Across Codebase

**Status:** ðŸ“‹ To Do
**Epic:** EPIC-028 Comprehensive Codebase Cleanup
**Priority:** Medium
**Risk Level:** ðŸŸ¡ Low-Medium Risk
**Estimated Effort:** 2-3 hours

---

## Story

As a **developer navigating the Stat-urday Synthesis codebase**, I want **all import statements organized consistently following the established standard (standard lib â†’ third-party â†’ local, alphabetically sorted)**, so that **imports are easy to read, understand dependencies at a glance, and avoid circular import issues**.

---

## Acceptance Criteria

1. **isort applied to all Python files** in project root:
   - Core modules: main.py, ranking_service.py, models.py, schemas.py, database.py, cfbd_client.py
   - Utility scripts: import_real_data.py, seed_data.py, demo.py, compare_rankings.py
   - All root-level .py files (54 files)

2. **isort applied to scripts/ directory**:
   - All 20 Python files in scripts/

3. **isort applied to tests/ directory**:
   - All test files, conftest.py, factories.py

4. **Import organization follows standard**:
   - Group 1: Standard library (os, sys, datetime, etc.)
   - Group 2: Third-party (fastapi, sqlalchemy, pydantic, pytest, etc.)
   - Group 3: Local application (models, schemas, database, ranking_service)
   - Each group alphabetically sorted
   - Groups separated by blank line

5. **Automated check added** to CONTRIBUTING.md recommending developers run `isort .` before commits

---

## Integration Verification

- **IV1: Full Test Suite Pass** - Run all 124 tests after import reorganization - all must pass
- **IV2: Application Startup** - Start FastAPI backend with `python main.py` (or current startup method) - must start without errors
- **IV3: Import Verification** - Run `python -c "import main; import ranking_service; import models"` - no import errors

---

## Dev Notes

### Previous Story Insights

**Story 28.2 Completed:**
- isort configuration added to pyproject.toml
- Import organization standards documented in CODING-STANDARDS.md

**Story 28.3 Completed:**
- Comprehensive docstrings added to all core modules
- All 124 tests passing

**Dependency:**
- This story uses isort configuration from Story 28.2
- Must verify test suite still passes after import reordering

[Source: `docs/stories/28.2.story.md`, `docs/stories/28.3.story.md`]

### File Locations

**Files to Modify (Apply isort):**
- **Root directory**: All 54 .py files
- **scripts/ directory**: All 20 .py files
- **tests/ directory**: All test files, conftest.py, factories.py

**Files to Reference:**
- `pyproject.toml` - isort configuration (from Story 28.2)
- `docs/CODING-STANDARDS.md` - Import organization standards

[Source: `docs/architecture.md#Source Tree and Module Organization`]

### isort Configuration

**From pyproject.toml (Story 28.2):**
```toml
[tool.isort]
profile = "black"
line_length = 100
known_first_party = ["src"]
multi_line_output = 3
include_trailing_comma = true
force_grid_wrap = 0
use_parentheses = true
ensure_newline_before_comments = true
```

**Expected Import Format:**
```python
# Group 1: Standard library imports
import os
import sys
from datetime import datetime
from typing import List, Optional

# Group 2: Third-party imports
from fastapi import Depends, FastAPI, HTTPException, Query
from pydantic import BaseModel
from sqlalchemy import create_engine
from sqlalchemy.orm import Session

# Group 3: Local application imports
import schemas
from database import get_db
from models import Game, Team
from ranking_service import RankingService
```

[Source: `docs/CODING-STANDARDS.md`, `pyproject.toml`]

### Technical Constraints

- **Import reordering only** - No other code changes
- **Automated tool** - Use isort, don't manually reorder
- **Test suite must pass** - Import order can expose circular dependencies
- **Watch for circular imports** - If tests fail, may reveal hidden issues
- **Git diff large** - Many files affected, review carefully

[Source: `docs/prd.md#Technical Constraints`]

### Testing Requirements

**Pre-Apply Verification:**
```bash
# Check current state (don't apply yet)
isort --check-only --diff .

# Document planned changes
isort --check-only . 2>&1 | tee isort-changes.txt
```

**Apply isort:**
```bash
# Apply to all Python files
isort .

# Verify changes
git diff --stat
```

**Post-Apply Verification:**
```bash
# Run full test suite
pytest -v

# Verify imports work
python -c "import main; import ranking_service; import models; import schemas; import database; import cfbd_client"

# Start backend
python main.py
# Should start without errors

# Test API endpoint
curl http://localhost:8000/api/rankings
# Should return JSON response
```

[Source: `docs/EPIC-028-CODEBASE-CLEANUP.md#Story 28.4`]

### Risk Mitigation

**Circular Import Detection:**
- Import reordering can expose hidden circular dependencies
- If imports fail after reordering, indicates existing issue
- Test thoroughly, especially import statements

**Strategies:**
1. Run tests immediately after applying isort
2. If tests fail, investigate import errors carefully
3. May need to refactor circular dependencies if discovered
4. Git provides easy rollback if needed

---

## Tasks / Subtasks

1. **Pre-Apply Analysis** (15 minutes)
   - Run `isort --check-only --diff .` to see planned changes
   - Save output: `isort --check-only . 2>&1 | tee isort-changes.txt`
   - Review changes to understand scope
   - Identify any concerning changes
   - (Preparation for AC 1-4)

2. **Apply isort to Root Directory** (20 minutes)
   - Run `isort *.py` on root directory (54 files)
   - Review git diff for unexpected changes
   - Run `python -c "import main"` to verify main imports work
   - (AC: 1, 4)

3. **Apply isort to scripts/ Directory** (15 minutes)
   - Run `isort scripts/` (20 files)
   - Review git diff for scripts/ directory
   - Spot-check 2-3 scripts: `python scripts/weekly_update.py --help`
   - (AC: 2, 4)

4. **Apply isort to tests/ Directory** (15 minutes)
   - Run `isort tests/` (all test files)
   - Review git diff for tests/ directory
   - Run quick test: `pytest tests/unit/test_models.py -v`
   - (AC: 3, 4)

5. **Run Full Test Suite** (20 minutes)
   - Run `pytest -v` - ALL 124 tests must pass
   - If failures occur, investigate import errors
   - Fix any circular dependencies if discovered
   - Re-run tests until all pass
   - (IV1)

6. **Verify Application Functionality** (15 minutes)
   - Start backend: `python main.py`
   - Verify starts without import errors
   - Test API endpoint: `curl http://localhost:8000/api/rankings`
   - Load frontend in browser, verify pages load
   - (IV2)

7. **Verify Imports** (10 minutes)
   - Run `python -c "import main; import ranking_service; import models; import schemas"`
   - Verify no ImportError exceptions
   - Check that all core modules import successfully
   - (IV3)

8. **Update CONTRIBUTING.md** (10 minutes)
   - Add section recommending `isort .` before commits
   - Include command in pre-commit checklist
   - Document how to check imports: `isort --check-only .`
   - (AC: 5)

9. **Review and Commit** (10 minutes)
   - Review git diff carefully (many files changed)
   - Verify only import order changed, no functional changes
   - Commit with message: "Standardize import statements across codebase (Story 28.4)"
   - (AC: 1-5, IV1-IV3)

---

## Definition of Done

- [ ] isort applied to all root Python files (54 files)
- [ ] isort applied to all scripts/ files (20 files)
- [ ] isort applied to all tests/ files
- [ ] All imports follow standard organization
- [ ] CONTRIBUTING.md updated with isort recommendation
- [ ] Full test suite passes (124 tests)
- [ ] Backend starts without import errors
- [ ] API endpoints respond correctly
- [ ] Import verification passes
- [ ] All acceptance criteria met (AC 1-5)
- [ ] All integration verifications pass (IV1-IV3)
- [ ] Changes committed with proper message

---

## Rollback Plan

**Risk Level:** ðŸŸ¡ Low-Medium Risk (import reordering can expose circular dependencies)

**Rollback Steps:**
1. `git revert <commit-hash>` - Restores original import order
2. Run test suite: `pytest -v` (verify rollback successful)
3. Start backend: `python main.py` (verify imports work)

**Rollback Impact:** If circular dependencies discovered, may need to fix them before proceeding with subsequent stories

---

## Notes

- **Mostly safe** - Import reordering rarely breaks code, but can expose hidden issues
- **Large git diff** - Many files touched, but changes are mechanical
- **Circular dependency detection** - If tests fail, it reveals an existing problem worth fixing
- **Automated tool** - isort handles complexity, we just run the command
- **Quick story** - Despite touching many files, changes are automated and safe
- **Foundation for Story 28.5** - Clean imports before moving files makes next story easier

---

**Related Documents:**
- Epic: `docs/EPIC-028-CODEBASE-CLEANUP.md`
- PRD: `docs/prd.md`
- Previous Story: `docs/stories/28.3.story.md`
- Next Story: `docs/stories/28.5.story.md`
- isort Config: `pyproject.toml` (created in Story 28.2)
