# Story 22.2: Frontend Display of Conference Championship Games

**Epic:** EPIC-022 - Conference Championship Game Support
**Story:** 22.2
**Estimated Effort:** 3-4 hours
**Dependencies:** Story 22.1 (game_type field must exist in database)

---

## User Story

As a **college football fan**,
I want **conference championship games clearly labeled on team schedules**,
So that **I can easily identify which games are conference championships and distinguish them from regular season games**.

---

## Story Context

### Existing System Integration

- **Integrates with:**
  - `main.py` - FastAPI backend with team schedule endpoint
  - `frontend/js/team.js` - Team schedule display logic
  - `frontend/css/styles.css` - Badge and schedule styling
  - Pydantic schemas for API responses
- **Technology:** Python FastAPI, Vanilla JavaScript, CSS
- **Follows pattern:** FCS badge pattern from EPIC-011 (frontend/js/team.js:254-266)
- **Touch points:**
  - Team schedule API endpoint (`main.py:177`)
  - `createScheduleRow()` function (frontend/js/team.js:224)
  - FCS badge styling (frontend/css/styles.css)

### Current State

**Current API Response:**
- `/api/teams/{team_id}/schedule` returns game data with standard fields
- Does not include `game_type` field in response (added in Story 22.1)

**Current Frontend Display:**
- Shows FCS badge for FCS opponents (EPIC-011)
- No differentiation between regular season and conference championship games
- Badge pattern exists: `.fcs-badge` styling

**Desired State:**
- API response includes `game_type` field for each game
- Conference championship games display "CONF CHAMP" badge
- Badge styling distinct from FCS badge (different color, font weight)
- Badge appears next to opponent name similar to FCS badge
- Regular season games display without badge (no visual change)

---

## Acceptance Criteria

### Functional Requirements

1. **API returns game_type field**
   - `/api/teams/{team_id}/schedule` endpoint includes `game_type` in game objects
   - `game_type` is optional (nullable) - regular season games have NULL
   - Pydantic schema updated to include `game_type: Optional[str]`

2. **Conference championship badge displays on schedule**
   - Games with `game_type='conference_championship'` show badge
   - Badge text: "CONF CHAMP" (abbreviated to fit visually)
   - Badge appears next to opponent name (after the link)
   - Badge has distinct visual style (gold/yellow color to indicate championship)

3. **Regular season games unchanged**
   - Games with `game_type=NULL` display without badge (no regression)
   - Existing FCS badge display unchanged
   - Schedule layout and spacing unchanged

4. **Badge styling is responsive**
   - Badge text wraps appropriately on mobile devices
   - Badge color contrasts well with background
   - Badge aligns with opponent name text

### Integration Requirements

5. **API schema compatibility**
   - Existing API clients continue to work (game_type is optional field)
   - Response structure unchanged except for new optional field
   - No breaking changes to API contract

6. **Frontend follows existing patterns**
   - Badge creation follows FCS badge pattern (frontend/js/team.js:259-266)
   - CSS styling follows existing badge pattern (`.fcs-badge`)
   - No layout shifts when badge appears

7. **Visual distinction from FCS badge**
   - Conference championship badge uses different color (not gray)
   - Different text content ("CONF CHAMP" vs "FCS")
   - Same size and spacing as FCS badge for consistency

### Quality Requirements

8. **Unit tests for API**
   - Test `/api/teams/{team_id}/schedule` includes game_type field
   - Test game_type=NULL for regular season games
   - Test game_type='conference_championship' for championship games

9. **Visual regression testing**
   - Schedule page layout unchanged for regular season games
   - Conference championship badge appears correctly
   - FCS badge still appears correctly (no regression)
   - Mobile responsive design verified

10. **Browser compatibility**
    - Badge displays correctly in Chrome, Firefox, Safari
    - CSS variables for colors work across browsers
    - No JavaScript errors in browser console

---

## Technical Implementation

### Changes Required

#### File 1: `schemas.py` - Add game_type to API Response Schema

**Location:** Create or update Pydantic schemas

**Changes:**
```python
from typing import Optional
from pydantic import BaseModel

class GameInSchedule(BaseModel):
    """Game in team schedule response"""
    game_id: int
    week: int
    opponent_id: int
    opponent_name: str
    is_home: bool
    is_neutral_site: bool
    is_played: bool
    score: Optional[str] = None  # e.g., "W 35-24"
    is_fcs: bool
    excluded_from_rankings: bool

    # NEW: Game type classification
    game_type: Optional[str] = None  # NULL, 'conference_championship', 'bowl', 'playoff'

    class Config:
        from_attributes = True


class TeamSchedule(BaseModel):
    """Team schedule response"""
    team_id: int
    team_name: str
    season: int
    games: list[GameInSchedule]
```

#### File 2: `main.py` - Update Schedule Endpoint to Return game_type

**Location:** main.py:177-224 (get_team_schedule endpoint)

**Changes:**
```python
@app.get("/api/teams/{team_id}/schedule", response_model=schemas.TeamSchedule, tags=["Teams"])
async def get_team_schedule(team_id: int, season: int, db: Session = Depends(get_db)):
    """Get a team's schedule for a season"""
    team = db.query(Team).filter(Team.id == team_id).first()

    if not team:
        raise HTTPException(status_code=404, detail="Team not found")

    # Get all games for this team in the season
    home_games = db.query(Game).filter(
        Game.home_team_id == team_id,
        Game.season == season
    ).all()

    away_games = db.query(Game).filter(
        Game.away_team_id == team_id,
        Game.season == season
    ).all()

    # Combine and format games
    games = []
    for game in home_games + away_games:
        is_home = game.home_team_id == team_id
        opponent = game.away_team if is_home else game.home_team

        # Determine if game has been played
        is_played = game.is_processed

        # Format score if game played
        score = None
        if is_played:
            my_score = game.home_score if is_home else game.away_score
            opp_score = game.away_score if is_home else game.home_score
            result = "W" if my_score > opp_score else ("L" if my_score < opp_score else "T")
            score = f"{result} {my_score}-{opp_score}"

        games.append({
            "game_id": game.id,
            "week": game.week,
            "opponent_id": opponent.id,
            "opponent_name": opponent.name,
            "is_home": is_home,
            "is_neutral_site": game.is_neutral_site,
            "is_played": is_played,
            "score": score,
            "is_fcs": opponent.is_fcs,
            "excluded_from_rankings": game.excluded_from_rankings,
            "game_type": game.game_type  # NEW: Include game_type field
        })

    # Sort by week
    games.sort(key=lambda g: g["week"])

    return {
        "team_id": team.id,
        "team_name": team.name,
        "season": season,
        "games": games
    }
```

#### File 3: `frontend/js/team.js` - Add Conference Championship Badge

**Location:** frontend/js/team.js:224-297 (createScheduleRow function)

**Modification to opponent cell creation:**
```javascript
// Opponent
const oppCell = document.createElement('td');
const oppLink = document.createElement('a');
oppLink.href = `team.html?id=${game.opponent_id}`;
oppLink.textContent = game.opponent_name;

if (isFCS) {
  // FCS opponent - grayed out styling
  oppLink.style.color = 'var(--text-secondary)';
  oppLink.style.fontStyle = 'normal';

  // Add FCS badge
  const fcsBadge = document.createElement('span');
  fcsBadge.className = 'fcs-badge';
  fcsBadge.textContent = 'FCS';
  fcsBadge.title = 'FCS opponent - not included in rankings';
  oppCell.appendChild(oppLink);
  oppCell.appendChild(document.createTextNode(' '));
  oppCell.appendChild(fcsBadge);
} else if (isPlayed) {
  // FBS played game - normal styling
  oppLink.style.color = 'var(--primary-color)';
  oppLink.style.fontWeight = '600';
  oppCell.appendChild(oppLink);

  // NEW: Add conference championship badge if applicable
  if (game.game_type === 'conference_championship') {
    const confChampBadge = document.createElement('span');
    confChampBadge.className = 'conf-champ-badge';
    confChampBadge.textContent = 'CONF CHAMP';
    confChampBadge.title = 'Conference Championship Game';
    oppCell.appendChild(document.createTextNode(' '));
    oppCell.appendChild(confChampBadge);
  }
} else {
  // Future FBS game - grayed out
  oppLink.style.color = 'var(--text-secondary)';
  oppLink.style.fontStyle = 'italic';
  oppCell.appendChild(oppLink);

  // NEW: Add conference championship badge for scheduled championship games
  if (game.game_type === 'conference_championship') {
    const confChampBadge = document.createElement('span');
    confChampBadge.className = 'conf-champ-badge';
    confChampBadge.textContent = 'CONF CHAMP';
    confChampBadge.title = 'Conference Championship Game';
    oppCell.appendChild(document.createTextNode(' '));
    oppCell.appendChild(confChampBadge);
  }
}

oppLink.style.textDecoration = 'none';
oppLink.onmouseover = () => oppLink.style.textDecoration = 'underline';
oppLink.onmouseout = () => oppLink.style.textDecoration = 'none';

row.appendChild(oppCell);
```

#### File 4: `frontend/css/styles.css` - Add Conference Championship Badge Styling

**Add near existing `.fcs-badge` styles:**
```css
/* Conference Championship Badge */
.conf-champ-badge {
  display: inline-block;
  padding: 0.15rem 0.4rem;
  font-size: 0.65rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: 3px;

  /* Gold/yellow color to indicate championship significance */
  background-color: #FFD700;  /* Gold */
  color: #1a1a1a;  /* Dark text for contrast */

  /* Subtle border for definition */
  border: 1px solid #DAA520;  /* Darker gold */

  /* Spacing */
  margin-left: 0.5rem;
  vertical-align: middle;

  /* Visual emphasis */
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Hover effect for tooltip visibility */
.conf-champ-badge:hover {
  background-color: #FFED4E;  /* Lighter gold on hover */
  cursor: help;
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  .conf-champ-badge {
    background-color: #DAA520;  /* Darker gold for dark mode */
    color: #1a1a1a;  /* Keep dark text */
    border-color: #B8860B;  /* Even darker border */
  }

  .conf-champ-badge:hover {
    background-color: #F0C020;  /* Brighter on hover */
  }
}
```

### Testing Checklist

**API Tests (`tests/integration/test_teams_api.py`):**
- [ ] Test `/api/teams/{team_id}/schedule` includes game_type field
- [ ] Test regular season game has game_type=NULL
- [ ] Test conference championship game has game_type='conference_championship'
- [ ] Test API response schema is valid

**Frontend Visual Tests (Manual):**
- [ ] Conference championship badge appears for championship games
- [ ] Badge text is "CONF CHAMP" with gold background
- [ ] Badge appears next to opponent name with proper spacing
- [ ] Regular season games display without badge (no regression)
- [ ] FCS badge still appears correctly (no interference)
- [ ] Mobile responsive: badge wraps properly
- [ ] Badge tooltip shows on hover ("Conference Championship Game")

**Browser Compatibility Tests (Manual):**
- [ ] Chrome: Badge displays correctly
- [ ] Firefox: Badge displays correctly
- [ ] Safari: Badge displays correctly
- [ ] Mobile Safari: Badge displays correctly
- [ ] No JavaScript console errors

**Accessibility Tests:**
- [ ] Badge has title attribute for screen readers
- [ ] Color contrast meets WCAG AA standards (gold on white/dark backgrounds)
- [ ] Keyboard navigation doesn't break with badge

---

## Technical Notes

### Integration Approach
- **Follows FCS badge pattern**: Reuses proven badge pattern from EPIC-011
- **Optional field**: `game_type` is nullable, backward compatible
- **Progressive enhancement**: Badge only appears when game_type present

### Visual Design Rationale
- **Gold color**: Championship significance, distinct from gray FCS badge
- **"CONF CHAMP" text**: Abbreviated to fit visually (vs full "Conference Championship")
- **Same size as FCS badge**: Visual consistency across badge types
- **Tooltip**: Provides full text for clarity

### CSS Variables Used
- Consider using CSS variables for championship gold color
- Allows easy theming and dark mode support
- Example: `--championship-gold: #FFD700;`

### Key Constraints
- **Backward compatibility**: Existing schedules without game_type work unchanged
- **No layout shifts**: Badge addition doesn't break existing layout
- **Performance**: No additional API calls (game_type in existing response)
- **Visual hierarchy**: Badge doesn't overpower opponent name

### Rollback Plan
If visual issues arise:
1. Comment out badge creation code in team.js
2. Remove .conf-champ-badge CSS rules
3. Schedule displays return to pre-story state
4. API change is backward compatible (optional field ignored)

---

## Definition of Done

- [ ] **Functional requirements met**
  - [ ] API returns game_type field in schedule response
  - [ ] Conference championship badge displays on schedule
  - [ ] Regular season games unchanged

- [ ] **Integration requirements verified**
  - [ ] API schema is backward compatible
  - [ ] Frontend follows FCS badge pattern
  - [ ] Badge visually distinct from FCS badge

- [ ] **Existing functionality regression tested**
  - [ ] Regular season game display unchanged
  - [ ] FCS badge still appears correctly
  - [ ] Schedule page loads without errors
  - [ ] Mobile responsive layout intact

- [ ] **Code follows existing patterns and standards**
  - [ ] API schema follows Pydantic pattern
  - [ ] JavaScript follows existing team.js patterns
  - [ ] CSS follows existing badge styling pattern

- [ ] **Visual quality verified**
  - [ ] Badge color provides good contrast
  - [ ] Badge size and spacing appropriate
  - [ ] Tooltip provides helpful context
  - [ ] Dark mode styling works correctly

- [ ] **Tests pass**
  - [ ] API integration tests pass
  - [ ] Manual visual testing completed
  - [ ] Browser compatibility verified
  - [ ] No JavaScript console errors

---

## Visual Mockup

**Before (Regular Season Game):**
```
Week 1    Michigan    Home    W 35-24    +15.2
```

**After (Conference Championship):**
```
Week 14   Ohio State  Neutral  W 42-27  [CONF CHAMP]  +22.4
                                         ^gold badge
```

**With FCS Game (No Regression):**
```
Week 3    Eastern Michigan  Home  W 45-7  [FCS]  +5.1
                                          ^gray badge
```

---

## Risk and Compatibility Check

### Risk Assessment

**Primary Risk:** Badge styling conflicts with existing layout or breaks mobile display

**Mitigation:**
- Use existing FCS badge styling as template (proven pattern)
- Test on multiple screen sizes before deployment
- Use relative units (rem) for sizing (responsive)
- CSS box model won't cause layout shifts (inline-block)

**Secondary Risk:** Badge color has poor contrast in dark mode

**Mitigation:**
- Test in both light and dark modes
- Use CSS prefers-color-scheme media query
- Adjust gold shade for dark mode (darker gold)
- Ensure text color has sufficient contrast

**Rollback:**
- Remove badge display code from team.js (3 lines)
- Remove .conf-champ-badge CSS (15 lines)
- API change is non-breaking (optional field)

### Compatibility Verification

- [x] **No breaking changes to APIs** - game_type is optional field
- [x] **Frontend changes are additive** - Badge only appears for championship games
- [x] **Follows existing UI patterns** - Reuses FCS badge pattern
- [x] **Performance impact negligible** - No additional API calls, simple DOM manipulation

---

## Related Files

- `main.py` - Team schedule API endpoint
- `schemas.py` - Pydantic response schemas
- `frontend/js/team.js` - Team schedule display logic
- `frontend/css/styles.css` - Badge styling
- `tests/integration/test_teams_api.py` - API tests

---

## Next Story

**Story 22.3**: Ranking Processing for Conference Championships - Verify ELO rankings correctly process conference championship games
